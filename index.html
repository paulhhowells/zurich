<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Zürich | Clock</title>
		<style>
			html, body {
				margin: 0; padding: 0;
			}
			body {
				font-family: "Helvetica-Neue", sans-serif;
				background-color: #555;
				color: #fff;
			}
			h1 {
				margin: 0.5em 0;
				line-height: 1.25;
				font-size: 2rem;
				font-weight: 800;
				letter-spacing: -1pt;
				color: #EEE;
				text-shadow: 0 3px 5px #1117;
			}
			fieldset {
				margin: 0;
				padding: 0;
				border: none;
			}
			legend {
				position: relative;
				display: inline-block;
				margin-right: 2em;
				padding-inline-start: 0;
			}
			select {
				margin-right: 2em;
			}
			.frame {
				padding: 1rem;
			}
			svg#swissClock {
				width: 100%;
				height: auto;

				/* Calculate viewport height - (H1 + frame padding + form) */
				max-height: calc(100vh - 10rem);
			}

			#swissClock {
				--hourHandAngle: 45deg;
				--minuteHandAngle: 120deg;
				--secondHandAngle: 200deg;
			}
			#hourHand {
				transform: rotate(var(--hourHandAngle));
				transform-origin: center;
			}
			#minuteHand {
				transform: rotate(var(--minuteHandAngle));
				transform-origin: center;
			}
			#secondHand {
				transform: rotate(var(--secondHandAngle));
				transform-origin: center;
			}
		</style>
	</head>
	<body>
		<div class="frame">
			<h1>Zürich</h1>
			<svg
				id="swissClock"
				xmlns="http://www.w3.org/2000/svg"
				xmlns:xlink="http://www.w3.org/1999/xlink"
				viewBox="0 0 1024 1024"
			>
				<symbol id="hourMark">
					<rect
						x="496"
						y="80"
						width="32"
						height="108"
					/>
				</symbol>
				<symbol id="minuteMark">
					<rect
						x="506"
						y="80"
						width="12"
						height="32"
					/>
				</symbol>
				<filter id="dropShadow">
					<feDropShadow
						dx="0" dy="6"
						stdDeviation="8"
						flood-opacity="0.2" />
				</filter>

				<g id="clockFace" stroke="none">
					<circle
						fill="#E3E3E3"
						r="510"
						cx="512"
						cy="512"
					/>
					<circle
						fill="#EEE"
						r="472"
						cx="512"
						cy="512"
						filter="url(#dropShadow)"
					/>
					<g id="marks" fill="#262626">
						<g id="minuteMarks">
							<use href="#minuteMark" x="0" y="0" transform="rotate(0 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(6 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(12 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(18 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(24 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(30 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(36 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(42 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(48 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(54 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(60 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(66 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(72 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(78 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(84 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(90 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(96 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(102 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(108 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(114 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(120 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(126 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(132 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(138 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(144 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(150 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(156 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(162 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(168 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(174 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(180 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(186 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(192 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(198 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(204 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(210 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(216 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(222 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(228 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(234 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(240 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(246 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(252 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(258 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(264 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(270 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(276 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(282 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(288 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(294 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(300 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(306 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(312 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(318 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(324 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(330 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(336 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(342 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(348 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(354 512 512)" />
							<use href="#minuteMark" x="0" y="0" transform="rotate(360 512 512)" />
						</g>
						<g id="hourMarks">
							<use href="#hourMark" x="0" y="0" transform="rotate(0 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(30 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(60 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(90 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(120 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(150 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(180 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(210 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(240 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(270 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(300 512 512)" />
							<use href="#hourMark" x="0" y="0" transform="rotate(330 512 512)" />
						</g>
					</g>

					<g id="hands" fill="#222">
						<g
							id="hourHand"
							transform="rotate(0 512 512)">
							<polygon points="489,226	535,226 541,620	483,620" />
						</g>
						<g
							id="minuteHand"
							transform="rotate(0 512 512)">
							<polygon points="496,106 528,106 535,620 489,620" />
						</g>
						<g id="secondHand">
							<g
								transform="rotate(0 512 512)"
								fill="#A00">
								<polygon points="505.5,200 518.5,200 518.5,660 505.5,660" />
								<circle
									r="45"
									cx="512"
									cy="230"
								/>
							</g>
						</g>
					</g>
					<circle
						id="centre"
						fill="#EEE7"
						r="1"
						cx="512"
						cy="512"
					/>
				</g>
			</svg>
			<form name="timezone-form">
				<fieldset>
					<label for="locale-select">Locale</label>
					<select name="locale" id="locale-select"></select>
					<label for="timezone-select">Location</label>
					<select name="timezone" id="timezone-select"></select>
				</fieldset>
				<fieldset>
					<label for="minute-hand-increment-select">Minute Hand Increment</label>
					<select name="minute-hand" id="minute-hand-increment-select">
						<option value="seconds">seconds</option>
						<option value="minutes">minutes</option>
					</select>
				</fieldset>
				<fieldset>
					<label>
						<input type="radio" name="aesthetic" value="helvetica" id="helvetica" /> Helvetica
					</label>
					<label>
						<input type="radio" name="aesthetic" value="avenir" id="avenir" /> Avenir
					</label>
				</fieldset>
			</form>
		</div>
		<script>
			// TODO toggle seconds hand
			// 24 hour clock AM / PM
			// TODO night mode
			// TODO theme
			// TODO style form

			const AESTHETIC = {
				helvetica : {
					hourHand : '<polygon points="489,226 535,226 541,620 483,620" />',
					minuteHand : '<polygon points="496,106 528,106 535,620 489,620" />',
					secondHand : `<g
						transform="rotate(0 512 512)"
						fill="#A00">
						<polygon points="505.5,200 518.5,200 518.5,660 505.5,660" />
						<circle
							r="45"
							cx="512"
							cy="230"
						/>
					</g>`,
					hourMark : '<rect	x="496"	y="80" width="32"	height="108" />',
					minuteMark : '<rect	x="506"	y="80" width="12"	height="32"	/>',
				},
				avenir : {
					hourHand : '<polygon points="489,226 535,226 535,620 489,620" />',
					minuteHand : '<polygon points="496,140 528,140 528,600 496,600" />',
					secondHand : `<g
						transform="rotate(0 512 512)"
						fill="#A00">
						<polygon points="
							508,170 516,170 
							516,640 508,640" />
					</g>`,
					hourMark : '<rect	x="505"	y="79" width="14"	height="80"	/>',
					minuteMark : '<rect	x="510"	y="80" width="4" height="32" />',
				}
			};

			const swissClock = document.getElementById('swissClock');
			const localeSelect = document.getElementById('locale-select');
			const timeZoneSelect = document.getElementById('timezone-select');
			const minuteHandIncrementSelect = document.getElementById('minute-hand-increment-select');
			const helveticaRadio = document.getElementById('helvetica');
			const avenirRadio = document.getElementById('avenir');

			swissClock.style.setProperty('--hourHandAngle', '150deg');
			swissClock.style.setProperty('--minuteHandAngle', '150deg');
			swissClock.style.setProperty('--secondHandAngle', '150deg');

			const supportedLocales = getSupportedLocales();
			const ianaTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

			let currentLocale = ianaTimeZone.split('/')[0];
			let currentTimeZone = ianaTimeZone;
			let minuteHandIncrement = 'seconds';
			let hourIntl;
			let minuteIntl;
			let secondIntl;

			updateLocaleSelectOptions();
			updateLocationOptions();
			updateIntlOptions();
			setInterval(updateClock, 100);

			localeSelect.addEventListener('change', handleLocaleSelect);
			timeZoneSelect.addEventListener('change', handleTimeZoneSelect);
			minuteHandIncrementSelect.addEventListener('change', handleMinuteHandIncrementSelect);
			helveticaRadio.addEventListener('change', handleAestheticRadioChange);
			avenirRadio.addEventListener('change', handleAestheticRadioChange);

			function updateClock () {
				const now = new Date();
				const hour = hourIntl.format(now);
				const minute = minuteIntl.format(now);
				const second = secondIntl.format(now);

				// Calculate positions;
				const hourHandAngle = ((hour * 30) + (minute * 0.5)) + 'deg';
				const minuteHandAngle = (minuteHandIncrement === 'seconds')		
					? ((minute * 6) + (second * 0.1)) + 'deg'
					: (minute * 6) + 'deg';
				const secondHandAngle = (second * 6) + 'deg';

				swissClock.style.setProperty('--hourHandAngle', hourHandAngle);
				swissClock.style.setProperty('--minuteHandAngle', minuteHandAngle);
				swissClock.style.setProperty('--secondHandAngle', secondHandAngle);
			}

			function updateIntlOptions () {
				hourIntl = new Intl.DateTimeFormat([], { hour: 'numeric', timeZone: currentTimeZone	});
				minuteIntl = new Intl.DateTimeFormat([], { minute: 'numeric', timeZone: currentTimeZone	});
				secondIntl = new Intl.DateTimeFormat([], { second: 'numeric', timeZone: currentTimeZone });
			}

			function handleTimeZoneSelect (event) {
				currentTimeZone = event.target.value;

				updateIntlOptions();
			}

			function getSupportedLocales () {
				const supportedTimeZones = Intl.supportedValuesOf('timeZone');
				const supportedLocales = supportedTimeZones.reduce(
					(previousValue, timeZone) => {
						const split = timeZone.split('/');
						const locale = split.shift();
						const location = {
							timeZone,
							location: split.join(', ').replaceAll('_', ' ')
						};
						const locations = (previousValue[locale])
							? [...previousValue[locale], location]
							: [location];

						return {
							...previousValue,
							[locale]: locations
						}
					},
					{}
				);

				return supportedLocales;
			}

			function handleMinuteHandIncrementSelect (event) {
				minuteHandIncrement = event.target.value;
			}

			function handleLocaleSelect (event) {
				currentLocale = event.target.value;
				currentTimeZone = supportedLocales[currentLocale][0].timeZone;

				updateIntlOptions();
				updateLocationOptions();
			}

			function updateLocaleSelectOptions () {
				const localeOptions = Object
					.keys(supportedLocales)
					.sort()
					.map(locale => new Option(
						locale,
						locale,
						Boolean(locale === currentLocale),
						Boolean(locale === currentLocale)
					));

				localeOptions.forEach(localeOption => localeSelect.appendChild(localeOption));
			}

			function updateLocationOptions () {
				const timeZones = supportedLocales[currentLocale];
				const timeZoneOptions = timeZones.map(
					({ location, timeZone }) => new Option(
						location,
						timeZone,
						Boolean(timeZone === currentTimeZone),
						Boolean(timeZone === currentTimeZone)
					)
				);

				timeZoneSelect.innerHTML = '';
				timeZoneOptions.forEach(timeZoneOption => timeZoneSelect.appendChild(timeZoneOption));
			}
			
			function handleAestheticRadioChange (event) {
				const aesthetic = AESTHETIC[event.target.value];

				for (const element in aesthetic) {
					document.getElementById(element).innerHTML = aesthetic[element];
				}	
			}
		</script>
	</body>
</html>
